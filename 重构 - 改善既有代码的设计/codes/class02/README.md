# 2 重构的原则

## 2.1 何为重构
  从名词方面解释：对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。
  从动词方面解释：使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。
> 如果有人说他们的代码在重构过程中有一两天时间不可用，基本上可以确定，他们在做的事不是重构

### 重构与性能优化

#### 共同点
  两者都需要修改代码，两者都需要修改代码，并且两者都不会改变程序的整体功能。

#### 区别
  重构是为了让代码更容易理解，更易于修改，这可能使程序运行得更快，也可能运行得更慢。<br> 
  性能优化时，只关心让程序运行得更快，最终得到的代码有可能更难理解和维护。


## 2.2 两顶帽子
  添加新功能和重构
> 无论何时都要清楚自己戴的是哪一顶帽子，并明白不同的帽子对编程状态提出的不同要求。

## 2.3 为何重构
+ 重构改进软件的设计
  + 改进设计的一个重要方向就是消除重复代码，要确定所有事物和行为在代码中只表述一次，这正是优秀设计的根本。
+ 重构使软件更容易理解
  + 程序设计，很大程度上就是与计算机对话。编程的核心就在于“准确说出我想要的”
+ 重构帮助找到bug
+ 重构提高编程速度

## 2.4 何时重构

> 三次法则：
> + 第一次做某件事时只管去做
> + 第二次做类似的事会产生反感
> + 第三次再做类似的事，你就应该重构 <br>
> 总之，事不过三，三则重构
> 

+ 预备性重构：让添加新功能更容易
+ 帮助理解的重构：使代码更易懂
+ 捡垃圾式的重构
  + 重构对的妙处在于每个小步骤都不会破坏代码，所以，积少成多，垃圾代码总会被清理干净
+ 有计划的重构和见机行事的重构
  + 肮脏的代码必须重构，但漂亮的代码也需要很多重构
+ 长期重构
+ 复审代码时重构

### 何时不应该重构
+ 凌乱的代码，但并不需要修改，那么就不需要重构
+ 如果重写比重构还容易，那直接重写。

## 2.5 重构的挑战
+ 延缓新功能开发
  + 重构的意义不在于把代码库打磨得闪闪发光，而是纯粹从经济角度出发的考量，之所以重构，是因为它能让我们更快————添加功能更快，修复bug更快
+ 代码所有权
  + 代码所有权的边界会妨碍重构，较为宽容的代码所有制甚至可以应用于跨团队的场合
+ 分支
 + CI（持续集成）避免了任何分支彼此差异太大，从而极大地降低了合并的难度。在软件交付上更加高效
+ 测试
  + 自测试代码与持续集成紧密相关————我们仰赖持续集成来及时捕获分支集成时的语义冲突。自测试代码是极限编程的另一个重要组成部分，也是持续交付的关键环节
+ 遗留代码
  + 遗留代码未必是好事。重构可以帮助我们很好地理解遗留系统，该修改的修改，糟糕的程序可以重构慢慢理顺，没有测试的系统就加测试。
+ 数据库

## 2.6 重构、架构和YAGNI
  重构极大地改变了人们考虑软件架构的方式。通过重构，我们能得到一个设计良好的代码库，使其能够优雅地应对不断变化的需求。<br>
  有了重构技术，我们就可以采取不同的策略，与其猜测未来需要哪些灵活性，需要什么机制来提供灵活性，我更愿意只根据当前的需求来构造软件，同时把软件质量做得很高。<br>
  只有当未来重构会很困难时，我们才会考虑现在就添加灵活性机制，其中一个很有用的决策方法就是简单设计，也可以叫增量式设计或YAGNI————"你不会需要它（you aren't going to need it）”。YAGNI是将架构、设计与开发过程融合的一种工作方式，这种工作方式必须有重构作为基础才可靠。

## 2.7 重构与软件开发过程
  极限编程是最早的敏捷软件开发方法之一。  
  重构和YAGNI交相呼应，彼此增效。重构（及其前置实践）是YAGNI的基础，YAGNI又让重构更易于开展。

## 2.8 重构与性能
  “编写快速软件”的秘密：先写出可调优的软件，然后调优它以求获得足够的速度。
三种方法：
+ 时间预算法
  + 分解你的设时就要做好预算，给每个组件预先分配一定资源，包括时间和空间占用
+ 持续关注法
  + 要求何时何地做何事时，都要设法保持系统的高性能
+ 利用上述的 90% 统计数据
  + 采用此方法，编写良好的程序时，就不对性能加以特别关注，直至进入性能优化阶段，再遵循特定的流程来调优程序。

## 2.9 重构起源何处
  最早认识重构重要性的是Ward Cunningham 和 Kent Beck。
  他俩的思想对Smalltalk社区产生了极大的影响。Smalltalk的另一位领袖是Ralph Johnson，他揭示了重构有助于灵活高效框架的开发。
  John Brant 和 Don Roberts 将 “重构工具” 的构想发扬光大，开发了一个名叫Refactoring Browser(重构浏览器)的重构工具（第一个自动化的重构工具）。

## 2.10 自动化重构
Refactoring Browser - 第一个自动化重构工具